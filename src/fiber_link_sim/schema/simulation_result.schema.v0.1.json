{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "fiber-physics.simulation-result.schema.v0.1",
  "title": "Fiber Physics SimulationResult",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "v",
    "status",
    "provenance",
    "warnings",
    "artifacts"
  ],
  "properties": {
    "v": {
      "type": "string",
      "minLength": 1
    },
    "status": {
      "type": "string",
      "enum": [
        "success",
        "error"
      ]
    },
    "summary": {
      "$ref": "#/$defs/Summary"
    },
    "error": {
      "$ref": "#/$defs/Error"
    },
    "provenance": {
      "$ref": "#/$defs/Provenance"
    },
    "warnings": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "artifacts": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Artifact"
      }
    },
    "best_found_spec_patch": {
      "type": "object",
      "additionalProperties": true
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "status": {
            "const": "success"
          }
        }
      },
      "then": {
        "required": [
          "summary"
        ],
        "not": {
          "required": [
            "error"
          ]
        }
      }
    },
    {
      "if": {
        "properties": {
          "status": {
            "const": "error"
          }
        }
      },
      "then": {
        "required": [
          "error"
        ],
        "not": {
          "required": [
            "summary"
          ]
        }
      }
    }
  ],
  "$defs": {
    "Summary": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "latency_s",
        "throughput_bps",
        "errors"
      ],
      "properties": {
        "latency_s": {
          "$ref": "#/$defs/Latency"
        },
        "throughput_bps": {
          "$ref": "#/$defs/Throughput"
        },
        "errors": {
          "$ref": "#/$defs/Errors"
        },
        "osnr_db": {
          "type": "number"
        },
        "snr_db": {
          "type": "number"
        },
        "evm_rms": {
          "type": "number"
        },
        "q_factor_db": {
          "type": "number"
        }
      }
    },
    "Latency": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "propagation",
        "serialization",
        "processing_est",
        "total"
      ],
      "properties": {
        "propagation": {
          "type": "number",
          "minimum": 0
        },
        "serialization": {
          "type": "number",
          "minimum": 0
        },
        "processing_est": {
          "type": "number",
          "minimum": 0
        },
        "total": {
          "type": "number",
          "minimum": 0
        }
      }
    },
    "Throughput": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "raw_line_rate",
        "net_after_fec",
        "goodput_est"
      ],
      "properties": {
        "raw_line_rate": {
          "type": "number",
          "minimum": 0
        },
        "net_after_fec": {
          "type": "number",
          "minimum": 0
        },
        "goodput_est": {
          "type": "number",
          "minimum": 0
        }
      }
    },
    "Errors": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "pre_fec_ber",
        "post_fec_ber",
        "fer"
      ],
      "properties": {
        "pre_fec_ber": {
          "type": "number",
          "minimum": 0
        },
        "post_fec_ber": {
          "type": "number",
          "minimum": 0
        },
        "fer": {
          "type": "number",
          "minimum": 0
        }
      }
    },
    "Provenance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "sim_version",
        "spec_hash",
        "seed",
        "runtime_s"
      ],
      "properties": {
        "sim_version": {
          "type": "string"
        },
        "spec_hash": {
          "type": "string"
        },
        "seed": {
          "type": "integer"
        },
        "runtime_s": {
          "type": "number",
          "minimum": 0
        },
        "backend": {
          "type": "string"
        },
        "model": {
          "type": "string"
        }
      }
    },
    "Artifact": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "name",
        "type",
        "ref"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "png",
            "npz",
            "json",
            "txt",
            "bin"
          ]
        },
        "ref": {
          "type": "string"
        },
        "mime": {
          "type": "string"
        },
        "bytes": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "Error": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "code",
        "message"
      ],
      "properties": {
        "code": {
          "type": "string",
          "enum": [
            "validation_error",
            "runtime_error",
            "timeout",
            "not_implemented"
          ]
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "object",
          "additionalProperties": true
        }
      }
    }
  }
}